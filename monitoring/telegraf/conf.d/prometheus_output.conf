# Prometheus Output Plugin Configuration
# Send metrics to Grafana Labs Prometheus datastore using remote write

# Primary: Remote write to Grafana Cloud Prometheus
[[outputs.http]]
  ## URL is the address to send metrics to
  url = "$PROMETHEUS_REMOTE_WRITE_URL"

  ## Timeout for HTTP messages.
  timeout = "5s"

  ## HTTP method, one of: "POST" or "PUT"
  method = "POST"

  ## HTTP Basic Auth credentials
  username = "$PROMETHEUS_USERNAME"
  password = "$PROMETHEUS_PASSWORD"

  ## Optional HTTP headers
  [outputs.http.headers]
    Content-Type = "application/x-protobuf"
    Content-Encoding = "snappy"
    X-Prometheus-Remote-Write-Version = "0.1.0"

  ## Data format to output.
  data_format = "prometheusremotewrite"

# Optional: Local Prometheus endpoint for debugging and backup monitoring
[[outputs.prometheus_client]]
  ## Address to listen on for Prometheus scrapes
  listen = ":9273"
  
  ## Metric version controls the mapping from telegraf metrics into prometheus format
  metric_version = 2

  ## Path to publish the metrics on
  path = "/metrics"

  ## Expiration interval for each metric. 0 == no expiration
  expiration_interval = "60s"

  ## Collectors to exclude
  collectors_exclude = ["gocollector", "process"]

  ## Send string metrics as Prometheus labels
  string_as_label = true

  ## Export metric collection time
  export_timestamp = true
